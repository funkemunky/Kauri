package dev.brighten.anticheat.check.impl.regular.packets.exploits;

import cc.funkemunky.api.tinyprotocol.packet.in.WrappedInUpdateSignPacket;
import dev.brighten.anticheat.check.api.Check;
import dev.brighten.anticheat.check.api.CheckInfo;
import dev.brighten.anticheat.check.api.Event;
import dev.brighten.anticheat.check.api.Packet;
import dev.brighten.api.check.CheckType;
import lombok.val;
import org.bukkit.event.block.SignChangeEvent;

import java.util.Arrays;

@CheckInfo(name = "SignCrash", description = "Prevents sign-based chunk crashers.", checkType = CheckType.EXPLOIT,
        punishVL = 1, vlToFlag = 0)
public class SignCrash extends Check {

    @Event
    public void onSignChange(SignChangeEvent event) {
        val optional = Arrays.stream(event.getLines())
                .filter(s -> s.length() > 100).findFirst();

        if(optional.isPresent()) {
            vl++;
            flag("length=%s", optional.get().length());
            event.setCancelled(true);
        }
    }
}
