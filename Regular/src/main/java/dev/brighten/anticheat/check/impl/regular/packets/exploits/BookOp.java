package dev.brighten.anticheat.check.impl.regular.packets.exploits;

import dev.brighten.anticheat.check.api.Check;
import dev.brighten.anticheat.check.api.CheckInfo;
import dev.brighten.anticheat.check.api.Event;
import dev.brighten.api.check.CheckType;
import lombok.val;
import org.bukkit.event.player.PlayerEditBookEvent;

@CheckInfo(name = "BookOp", description = "Prevents the user from creating JSON command actions in books.",
        checkType = CheckType.EXPLOIT, punishVL = 0, executable = false, vlToFlag = 0)
public class BookOp extends Check {
    @Event
    public void onEvent(PlayerEditBookEvent event) {
        val optional = event.getNewBookMeta().getPages().stream()
                .filter(string -> string.toLowerCase().contains("run_command"))
                .findFirst();
        if(optional.isPresent()) {
            vl++;
            flag("line=" + optional.get());
            event.setCancelled(true);
        }
    }

}
