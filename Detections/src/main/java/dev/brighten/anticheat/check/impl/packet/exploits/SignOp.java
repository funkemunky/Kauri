package dev.brighten.anticheat.check.impl.packet.exploits;

import dev.brighten.anticheat.check.api.Check;
import dev.brighten.anticheat.check.api.CheckInfo;
import dev.brighten.anticheat.check.api.Event;
import dev.brighten.api.check.CheckType;
import lombok.val;
import org.bukkit.event.block.SignChangeEvent;

import java.util.Arrays;

@CheckInfo(name = "SignOp", description = "Prevents the use of sign JSON run_command actions.",
        checkType = CheckType.EXPLOIT, punishVL = 1, vlToFlag = 0)
public class SignOp extends Check {

    @Event
    public void onSign(SignChangeEvent event) {
        val optional = Arrays.stream(event.getLines())
                .filter(string -> string.toLowerCase().contains("run_command"))
                .findFirst();
        if(optional.isPresent()) {
            vl++;
            flag("line=%s", optional.get());
            event.setCancelled(true);
        }
    }
}
